import{_ as ye,b9 as xe,a6 as be,h as we,e as x,B as m,i as S,o as U,a8 as Z,u as Ae,a as C,ar as ke}from"./index-BAQrwGvC.js";import{d as u}from"./d3-importer-DbRjC5NP.js";import{a as J,b as R,o as Se,d as M,f as Q}from"./customColors-DDLtqmto.js";const Ce={id:"tooltip"},Me={key:0,class:"headshot"},Fe=20,ze={__name:"TheGrandCouncil",setup(Oe){const h=xe(),i=be();we(()=>{f.value=u.select("#tooltip"),j(),i.numberOfFetches>0&&O()});const B=x(null),F=x(null),n=x({width:null,height:null,margin:{top:null,right:null,bottom:null,left:null},ctrWidth:null,ctrHeight:null}),b=m(()=>i.asOfDate&&i.membersAsOfDate?i.membersAsOfDate:i.membersCurrent),r=m(()=>i.seatArrangement?i.seatArrangement:""),s=m(()=>i.seatFeature),V=m(()=>i.memberFocus),g=m(()=>{if(!r.value)return[""];const e=W(r.value);if(z(e[0])){const t=u.min(e),l=u.max(e);return l-t>100&&t===0?[1,l]:[t,l]}return e.sort()});function z(e){return Number.isInteger(Number(e))}function W(e){return Array.from(new Set(b.value.map(t=>t[e])))}const o=m(()=>{const t=typeof g.value[0]=="string",l=g.value[1]<=100;return t?{type:"band"}:l?{type:"linear"}:{type:"log"}});S(()=>o.value,(e,t)=>{const l=e.type!==t.type;le(l)},{deep:!1}),S(()=>r.value,async(e,t)=>{await O(),e==="occupation"&&await L("increased"),t==="occupation"&&await L("regular")}),S(()=>s.value,()=>{O()}),S(()=>V.value,()=>{q(b.value)});const p=x(null),w=x(null);S(()=>i.newFetchingDone,async e=>{e&&O()});const G=x(null);async function j(){await ee(),await N()}async function ee(){const e=u.select("#grand-council-basel");await te(e),B.value=e.append("svg").attr("id","svg-visualization").attr("viewBox",`0 0 ${n.value.width} ${n.value.height}`),F.value=B.value.append("g").attr("id","visualization-ctr").attr("transform",`translate(${n.value.margin.left}, ${n.value.margin.top})`)}async function L(e){const t=e==="increased"?I.value*100*1.1:n.value.height,l=e==="increased"?"270":"0";await B.value.transition().duration(2e3).attr("viewBox",`0 0 ${n.value.width} ${t}`).attr("transform",`rotate(${l})`).end(),e==="increased"&&await w.value.selectAll("text").transition().duration(1e3).style("text-anchor","start").style("font-size",()=>h.isMobile?"6px":"14px").attr("dy",".02rem").attr("dx",()=>-n.value.ctrHeight+D.value*v.value*2).attr("transform","rotate(90)").end()}async function te(e){n.value.width=e.node().getBoundingClientRect().width;const t=h.isMobile?.45:.3;n.value.height=n.value.width*t,n.value.margin.top=h.isMobile?10:50,n.value.margin.right=h.isMobile?5:25,n.value.margin.bottom=h.isMobile?18:25,n.value.margin.left=h.isMobile?5:25,n.value.ctrWidth=n.value.width-n.value.margin.left-n.value.margin.right,n.value.ctrHeight=n.value.height-n.value.margin.top-n.value.margin.bottom}async function O(){await b.value.sort((c,d)=>{if(r.value){if(c[r.value]<d[r.value])return-1;if(c[r.value]>d[r.value])return 1}if(s.value){if(c[s.value]<d[s.value])return-1;if(c[s.value]>d[s.value])return 1}else{if(c.name<d.name)return-1;if(c.name>d.name)return 1}});let e=null,t=-1,l=-1;b.value.forEach(c=>{c[r.value]!==e?(e=c[r.value],t=0):t+=1,c.innerIndex=t,t>l&&(l=t)}),D.value=l+1,console.log(b.value),await me(),await q(b.value)}async function N(){await ae(),await ne()}async function ae(){o.value.type==="band"?p.value=u.scaleBand().domain(g.value).range([0,n.value.ctrWidth]).paddingInner(.2).paddingOuter(.2).align(.5):o.value.type==="linear"?p.value=u.scaleLinear().domain(g.value).range([0,n.value.ctrWidth]).nice():p.value=u.scaleLog().domain(g.value).range([n.value.ctrWidth*.05,n.value.ctrWidth]).base(2).nice()}async function ne(){w.value=F.value.append("g").attr("id","x-axis").attr("transform",`translate(0, ${n.value.ctrHeight})`).style("font-size",()=>h.isMobile?"8px":"14px"),P()}async function le(e){e?(u.select("#x-axis").remove(),N()):(p.value.domain(g.value),P())}function P(){const e=u.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=u.axisBottom(p.value);if(o.value.type==="band"&&t.tickSize(0),o.value.type==="linear"){const l=g.value[1]<10?g.value[1]:12;t.tickSize(-n.value.ctrHeight).ticks(l).tickPadding(10).tickSizeOuter(0).tickFormat(e)}o.value.type==="log"&&t.tickSize(-n.value.ctrHeight).ticks(5).tickPadding(10).tickSizeOuter(0).tickFormat(e),w.value.transition().call(t),o.value.type==="band"?w.value.call(l=>l.select(".domain").remove()):w.value.selectAll(".tick line").style("stroke","lightgrey").style("stroke-dasharray","4,2")}const D=x(0),A=m(()=>o.value.type==="band"?Math.ceil(Fe/g.value.length):1),Y=m(()=>o.value.type==="band"?Math.ceil(D.value/A.value):D.value),re=m(()=>o.value.type==="band"?p.value.bandwidth():null),I=m(()=>o.value.type==="band"?re.value/A.value:n.value.ctrWidth/(g.value[1]-g.value[0])),H=m(()=>n.value.ctrHeight/Y.value),v=m(()=>{const t=I.value/2*.9,l=H.value/2*.9;return o.value.type==="band"?Y.value>A.value?Math.min(t,l):t:o.value.type==="linear"?Math.min(t,l):h.isMobile?3.3:5});function T(e){return o.value.type==="band"?ue(e):o.value.type==="linear"?oe(e):ce(e)}function _(e,t="update"){return t==="enter"?-v.value*2:t==="exit"?n.value.ctrHeight+v.value*2:o.value.type==="band"?ie(e):o.value.type==="linear"?se(e):ve(e)}function ue(e){const t=r.value?e[r.value]:"",l=e.innerIndex%A.value;return p.value(t)+l*I.value+I.value/2}function ie(e){const t=Math.floor(e.innerIndex/A.value);return r.value!=="occupation"?g.value[0]===""?t*H.value+H.value/2:t*H.value:t*v.value*2}function oe(e){return p.value(e[r.value])}function se(e){return n.value.ctrHeight-v.value-e.innerIndex*v.value*2}function ce(e){return e[r.value]!==0?p.value(e[r.value]):10}function ve(e){return n.value.ctrHeight-v.value-e.innerIndex*v.value*2}const E=m(()=>o.value.type==="log"?.65:.9);function fe(e){return e in R||z(e)}const X=m(()=>{if(!s.value)return{};const e=W(s.value),t=z(e[0]);let l,c;if(t){const d=u.min(e),y=u.max(e);l=y-d>100?"log":"linear",c=y-d>100&&d===0?[1,y]:[d,y]}else l=fe(s.value)?"custom":"ordinal",c=e.sort();return{type:l,domain:c}});async function me(){const{type:e,domain:t}=X.value,l={ordinal:()=>u.scaleOrdinal().domain(t).range(Se),linear:()=>u.scaleLinear().domain(t).range([M.lowColor,M.highColor]),log:()=>u.scaleLog().domain(t).range([M.lowColor,M.highColor]),default:()=>null};G.value=(l[e]||l.default)()}function $(e){if(!s.value)return"#000000";if(X.value.type==="custom"){const t=e[s.value];return z(s.value)?R.vote[t]:R[s.value][t]}return X.value.type==="log"&&e[s.value]===0?M.logZeroColor:G.value(e[s.value])}const f=x(null);function K(e){const t=i.focusOptions.findIndex(l=>l.value===e.id);return Q[t%Q.length]}async function q(e){let t=F.value.select(".seats-group");t.empty()&&(t=F.value.append("g").attr("class","seats-group"));const l=u.transition().duration(2500),c=i.numberOfFetches===1?u.transition().duration(2500):l.transition().duration(2500),d=u.transition().duration(2500),y=t.selectAll("circle").data(e,a=>a.id);y.exit().transition(l).attr("cx",a=>T(a)).attr("cy",a=>_(a,"exit")).attr("r",v.value).attr("fill",a=>$(a)).attr("fill-opacity",0).remove(),y.enter().append("circle").attr("class","seat").attr("cx",a=>T(a)).attr("cy",a=>_(a,"enter")).attr("r",v.value).attr("fill",a=>$(a)).attr("fill-opacity",0).attr("stroke",a=>a.focus?K(a):null).attr("stroke-width",a=>a.focus?v.value*2:null).attr("stroke-opacity",a=>a.focus?J:null).on("click",(a,k)=>{window.open(k.url,"_blank")}).on("mouseover",(a,k)=>de(k)).on("mousemove",a=>ge(a)).on("mouseout",()=>pe()).on("contextmenu",(a,k)=>he(a,k)).transition(c).attr("cx",a=>T(a)).attr("cy",a=>_(a)).attr("fill",a=>$(a)).attr("fill-opacity",E.value).attr("cursor","pointer"),y.transition(d).attr("cx",a=>T(a)).attr("cy",a=>_(a)).attr("r",v.value).attr("fill",a=>$(a)).attr("fill-opacity",E.value).attr("stroke",a=>a.focus?K(a):null).attr("stroke-width",a=>a.focus?v.value*2:null).attr("stroke-opacity",a=>a.focus?J:null).attr("cursor","pointer"),u.select(".seats-group").raise()}function de(e){i.membersAsOfDate||f.value.select(".headshot img").attr("src",e.image),f.value.select(".name").text(e.name),r.value===s.value?f.value.select(".arrangement").text(e[r.value]):(f.value.select(".arrangement").text(e[r.value]),f.value.select(".feature").text(e[s.value])),f.value.style("visibility","visible")}function ge(e){f.value.style("left",`${e.clientX+v.value}px`).style("top",`${e.clientY-v.value}px`)}function pe(){i.membersAsOfDate||f.value.select(".headshot img").attr("src",null),f.value.select(".name").text(null),f.value.select(".arrangement").text(null),f.value.select(".feature").text(null),f.value.select(".hint").text(null),f.value.style("visibility","hidden")}function he(e,t){e.preventDefault(),i.memberFocus?V.value.includes(t.id)||i.setMemberFocus([...V.value,t.id]):i.setMemberFocus([t.id])}return(e,t)=>(U(),Z("div",Ce,[Ae(i).membersAsOfDate?ke("",!0):(U(),Z("div",Me,t[0]||(t[0]=[C("img",null,null,-1)]))),t[1]||(t[1]=C("div",{class:"name"},null,-1)),t[2]||(t[2]=C("div",{class:"arrangement"},null,-1)),t[3]||(t[3]=C("div",{class:"feature"},null,-1)),t[4]||(t[4]=C("div",{class:"hint"},null,-1))]))}},Te=ye(ze,[["__scopeId","data-v-f1550c5b"]]);export{Te as default};
