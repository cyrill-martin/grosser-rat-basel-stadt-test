import{d as r}from"./d3-importer-DbRjC5NP.js";import{b9 as T,a6 as q,h as N,e as v,B as m,i as U,o as P,a8 as X}from"./index-BAQrwGvC.js";import{d as _,b as y,o as V}from"./customColors-DDLtqmto.js";const Z={__name:"TheLegend",setup(j){const s=T(),d=q();N(()=>{z()});async function z(){await E(),await w()}async function D(e){if(await b(),e==="band"){const t=l.value.length*13;await u.value.transition().attr("viewBox",`0 0 ${a.value.width} ${t}`).end()}else await u.value.transition().attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`).end()}async function w(){o.value.type!=="band"?(await W(),await F(),await G()):await L(l.value)}const u=v(null),g=v(null),a=v({width:null,height:null,margin:{top:s.isMobile?5:20,right:5,bottom:25,left:5},ctrWidth:null,ctrHeight:null});async function b(){const e=r.select("#grand-council-basel-legend"),t=r.select("#grand-council-basel");a.value.width=await e.node().getBoundingClientRect().width,s.isMobile?o.value.type!=="band"?a.value.height=await t.node().getBoundingClientRect().height*.5:a.value.height=1:a.value.height=await t.node().getBoundingClientRect().height,a.value.ctrWidth=a.value.width-a.value.margin.left-a.value.margin.right,a.value.ctrHeight=a.value.height-a.value.margin.top-a.value.margin.bottom}const H=m(()=>d.asOfDate&&d.membersAsOfDate?d.membersAsOfDate:d.membersCurrent),c=m(()=>d.seatFeature);function O(e){return Array.from(new Set(H.value.map(t=>t[e])))}function x(e){return Number.isInteger(Number(e))}const l=m(()=>{if(!c.value)return[""];const e=O(c.value);if(x(e[0])){const t=r.min(e),n=r.max(e);return n-t>100&&t===0?[1,n]:[t,n]}return e.sort()}),o=m(()=>{const t=typeof l.value[0]=="string",n=l.value[1]<=100;return t?{type:"band"}:n?{type:"linear"}:{type:"log"}});U(()=>o.value,(e,t)=>{const n=e.type!==t.type;R(n)},{deep:!1});const f=v(null),p=v(null);async function E(){const e=r.select("#grand-council-basel-legend");await b(),u.value=e.append("svg").attr("id","svg-legend").attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`);const t=s.isMobile?a.value.ctrWidth*.5:a.value.margin.left;g.value=u.value.append("g").attr("id","legend-ctr").attr("transform",`translate(${t}, ${a.value.margin.top})`)}async function F(){o.value.type==="linear"?f.value=r.scaleLinear().domain(l.value).range([0,a.value.ctrHeight]):f.value=r.scaleLog().domain(l.value).range([0,a.value.ctrHeight]).base(2)}const S=m(()=>{const e=s.isMobile?.05:.1;return a.value.ctrWidth*e});async function G(){p.value=g.value.append("g").attr("id","legend-axis").attr("transform",`translate(${S.value}, 0)`),C()}async function k(e){return e==="linear"?[l.value[0],(l.value[0]+l.value[1])/2,l.value[1]]:[l.value[0],Math.floor(Math.sqrt(l.value[0]*l.value[1])),l.value[1]]}async function C(){const e=r.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=r.axisRight(f.value);if(o.value.type==="linear"){const n=await k("linear");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}if(o.value.type==="log"){const n=await k("log");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}p.value.transition().call(t).style("font-size",()=>s.isMobile?"8px":"14px"),p.value.call(n=>n.select(".domain").remove())}async function R(e){s.isMobile&&await D(o.value.type),e?(r.select("#legend-axis").remove(),r.select("#color-bar").remove(),r.select("#legend-group").remove(),w()):o.value.type!=="band"?(f.value.domain(l.value),C()):L(l.value)}async function W(){let e=u.value.select("#legendGradient");e.empty()&&(e=u.value.append("defs").append("linearGradient").attr("id","legendGradient").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%"),e.append("stop").attr("offset","0%").attr("stop-color",_.lowColor),e.append("stop").attr("offset","100%").attr("stop-color",_.highColor)),g.value.append("rect").attr("id","color-bar").attr("x",0).attr("y",0).attr("width",S.value).transition().attr("height",a.value.ctrHeight).style("fill","url(#legendGradient)")}function I(e,t){return x(c.value)?y.vote[e]:c.value in y?y[c.value][e]:V[t%V.length]}async function L(e){let t=g.value.select("#legend-group");const n=s.isMobile?13:20,$=n/2*.75,B=e.map(i=>({id:`${c.value}_${i}`,value:i}));t.empty()&&(t=g.value.append("g").attr("id","legend-group"));const M=t.selectAll(".legend-item").data(B,i=>i.id);M.exit().transition().attr("transform",`translate(0, ${n*12})`).remove();const A=M.enter().append("g").attr("class","legend-item").attr("transform","translate(0, 0)");A.append("circle").attr("cx",$).attr("cy",0).attr("r",i=>i.value===""?null:$).attr("fill",(i,h)=>I(i.value,h)),A.append("text").attr("x",n).attr("y",0).style("font-size",()=>s.isMobile?"8px":"14px").attr("dominant-baseline","middle").text(i=>i.value),t.selectAll(".legend-item").data(B,i=>i.id).transition().attr("transform",(i,h)=>`translate(0, ${n*h})`).select("text").text(i=>i.value)}return(e,t)=>(P(),X("div"))}};export{Z as default};
