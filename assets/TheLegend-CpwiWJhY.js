import{bc as U,h as P,i as j,m as z,j as v,G as m,o as X,e as J}from"./index-CywPk8zq.js";import{d as r,b as D,c as y,o as H}from"./customColors-3l6lgcQx.js";import{d as K}from"./debounce-B_grFKK4.js";const ae={__name:"TheLegend",setup(Q){const o=U(),d=P();j(()=>{w()}),z(()=>o.width,()=>{G()});const G=K(()=>{O()},200);async function O(){r.select("#svg-legend").remove(),await w(),await $()}async function w(){await T(),await b()}async function R(e){if(await x(),e==="band"){const t=l.value.length*13;await u.value.transition().attr("viewBox",`0 0 ${a.value.width} ${t}`).end()}else await u.value.transition().attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`).end()}async function b(){s.value.type!=="band"?(await q(),await W(),await I()):await B(l.value)}const u=v(null),g=v(null),a=v({width:null,height:null,margin:{top:null,right:5,bottom:25,left:5},ctrWidth:null,ctrHeight:null});async function x(){const e=r.select("#grand-council-basel-legend"),t=r.select("#grand-council-basel");a.value.width=await e.node().getBoundingClientRect().width,o.isMobile?s.value.type!=="band"?a.value.height=await t.node().getBoundingClientRect().height*.5:a.value.height=1:a.value.height=await t.node().getBoundingClientRect().height||250,a.value.margin.top=o.isMobile?5:20,a.value.ctrWidth=a.value.width-a.value.margin.left-a.value.margin.right,a.value.ctrHeight=a.value.height-a.value.margin.top-a.value.margin.bottom}const E=m(()=>d.asOfDate&&d.membersAsOfDate?d.membersAsOfDate:d.membersCurrent),c=m(()=>d.seatFeature);function F(e){return Array.from(new Set(E.value.map(t=>t[e])))}function S(e){return Number.isInteger(Number(e))}const l=m(()=>{if(!c.value)return[""];const e=F(c.value);if(S(e[0])){const t=r.min(e),n=r.max(e);return n-t>100&&t===0?[1,n]:[t,n]}return e.sort()}),s=m(()=>{const t=typeof l.value[0]=="string",n=l.value[1]<=100;return t?{type:"band"}:n?{type:"linear"}:{type:"log"}});z(()=>s.value,(e,t)=>{const n=e.type!==t.type;$(n)},{deep:!1});const f=v(null),p=v(null);async function T(){const e=r.select("#grand-council-basel-legend");await x(),console.log("height??",a.value.height),u.value=e.append("svg").attr("id","svg-legend").attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`);const t=o.isMobile?a.value.ctrWidth*.5:a.value.margin.left;g.value=u.value.append("g").attr("id","legend-ctr").attr("transform",`translate(${t}, ${a.value.margin.top})`)}async function W(){s.value.type==="linear"?f.value=r.scaleLinear().domain(l.value).range([0,a.value.ctrHeight]):f.value=r.scaleLog().domain(l.value).range([0,a.value.ctrHeight]).base(2)}const k=m(()=>{const e=o.isMobile?.05:.1;return a.value.ctrWidth*e});async function I(){p.value=g.value.append("g").attr("id","legend-axis").attr("transform",`translate(${k.value}, 0)`),C()}async function L(e){return e==="linear"?[l.value[0],(l.value[0]+l.value[1])/2,l.value[1]]:[l.value[0],Math.floor(Math.sqrt(l.value[0]*l.value[1])),l.value[1]]}async function C(){const e=r.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=r.axisRight(f.value);if(s.value.type==="linear"){const n=await L("linear");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}if(s.value.type==="log"){const n=await L("log");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}p.value.transition().call(t).style("font-size",()=>o.isMobile?"8px":"14px"),p.value.call(n=>n.select(".domain").remove())}async function $(e){o.isMobile&&await R(s.value.type),e?(r.select("#legend-axis").remove(),r.select("#color-bar").remove(),r.select("#legend-group").remove(),b()):s.value.type!=="band"?(f.value.domain(l.value),C()):B(l.value)}async function q(){let e=u.value.select("#legendGradient");e.empty()&&(e=u.value.append("defs").append("linearGradient").attr("id","legendGradient").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%"),e.append("stop").attr("offset","0%").attr("stop-color",D.lowColor),e.append("stop").attr("offset","100%").attr("stop-color",D.highColor));const t=r.transition().duration(1e3);g.value.append("rect").attr("id","color-bar").attr("x",0).attr("y",0).attr("width",k.value).transition(t).attr("height",a.value.ctrHeight).style("fill","url(#legendGradient)")}function N(e,t){return S(c.value)?y.vote[e]:c.value in y?y[c.value][e]:H[t%H.length]}async function B(e){let t=g.value.select("#legend-group");const n=o.isMobile?13:20,M=n/2*.75,A=e.map(i=>({id:`${c.value}_${i}`,value:i}));t.empty()&&(t=g.value.append("g").attr("id","legend-group"));const _=t.selectAll(".legend-item").data(A,i=>i.id);_.exit().transition().attr("transform",`translate(0, ${n*12})`).remove();const V=_.enter().append("g").attr("class","legend-item").attr("transform","translate(0, 0)");V.append("circle").attr("cx",M).attr("cy",0).attr("r",i=>i.value===""?null:M).attr("fill",(i,h)=>N(i.value,h)),V.append("text").attr("x",n).attr("y",0).style("font-size",()=>o.isMobile?"8px":"14px").attr("dominant-baseline","middle").text(i=>i.value),t.selectAll(".legend-item").data(A,i=>i.id).attr("transform",(i,h)=>`translate(0, ${n*h})`).select("text").text(i=>i.value)}return(e,t)=>(X(),J("div"))}};export{ae as default};
