import{_ as be,bc as we,h as Ae,i as Se,m as w,j as x,G as m,o as Z,e as J,u as ke,a as C,au as Ce}from"./index-CywPk8zq.js";import{d as r,a as Q,c as W,o as Me,b as M,f as j}from"./customColors-3l6lgcQx.js";import{d as ze}from"./debounce-B_grFKK4.js";const Fe={id:"tooltip"},De={key:0,class:"headshot"},Oe=20,Ie={__name:"TheGrandCouncil",setup(Te){const p=we(),o=Ae();Se(()=>{d.value=r.select("#tooltip"),P(),o.numberOfFetches>0&&D()}),w(()=>p.width,()=>{ee()});const ee=ze(()=>{te()},200);async function te(){r.select("#svg-visualization").remove(),await P(),await G(b.value),i.value==="occupation"&&await B("increased")}const _=x(null),z=x(null),n=x({width:null,height:null,margin:{top:null,right:null,bottom:null,left:null},ctrWidth:null,ctrHeight:null}),b=m(()=>o.asOfDate&&o.membersAsOfDate?o.membersAsOfDate:o.membersCurrent),i=m(()=>o.seatArrangement?o.seatArrangement:""),c=m(()=>o.seatFeature),$=m(()=>o.memberFocus),g=m(()=>{if(!i.value)return[""];const e=L(i.value);if(F(e[0])){const t=r.min(e),l=r.max(e);return l-t>100&&t===0?[1,l]:[t,l]}return e.sort()});function F(e){return Number.isInteger(Number(e))}function L(e){return Array.from(new Set(b.value.map(t=>t[e])))}const s=m(()=>{const t=typeof g.value[0]=="string",l=g.value[1]<=100;return t?{type:"band"}:l?{type:"linear"}:{type:"log"}});w(()=>s.value,(e,t)=>{const l=e.type!==t.type;ie(l)},{deep:!1}),w(()=>i.value,async(e,t)=>{await D(),e==="occupation"&&await B("increased"),t==="occupation"&&await B("regular")}),w(()=>c.value,()=>{D()}),w(()=>$.value,()=>{G(b.value)});const h=x(null),A=x(null);w(()=>o.newFetchingDone,async e=>{e&&D()});const N=x(null);async function P(){await ae(),await Y()}async function ae(){const e=r.select("#grand-council-basel");await ne(e),_.value=e.append("svg").attr("id","svg-visualization").attr("viewBox",`0 0 ${n.value.width} ${n.value.height}`),z.value=_.value.append("g").attr("id","visualization-ctr").attr("transform",`translate(${n.value.margin.left}, ${n.value.margin.top})`)}async function B(e){const t=e==="increased"?I.value*100*1.1:n.value.height,l=e==="increased"?"270":"0",u=r.transition().duration(2500),f=u.transition().duration(1500);await _.value.transition(u).attr("viewBox",`0 0 ${n.value.width} ${t}`).attr("transform",`rotate(${l})`),e==="increased"&&await A.value.selectAll("text").transition(f).style("text-anchor","start").style("font-size",()=>p.isMobile?"6px":"14px").attr("dy",".02rem").attr("dx",()=>-n.value.ctrHeight+O.value*v.value*2).attr("transform","rotate(90)")}async function ne(e){n.value.width=e.node().getBoundingClientRect().width;const t=p.isMobile?.45:.3;n.value.height=n.value.width*t,n.value.margin.top=p.isMobile?10:50,n.value.margin.right=p.isMobile?5:25,n.value.margin.bottom=p.isMobile?18:25,n.value.margin.left=p.isMobile?5:25,n.value.ctrWidth=n.value.width-n.value.margin.left-n.value.margin.right,n.value.ctrHeight=n.value.height-n.value.margin.top-n.value.margin.bottom}async function D(){await b.value.sort((u,f)=>{if(i.value){if(u[i.value]<f[i.value])return-1;if(u[i.value]>f[i.value])return 1}if(c.value){if(u[c.value]<f[c.value])return-1;if(u[c.value]>f[c.value])return 1}else{if(u.name<f.name)return-1;if(u.name>f.name)return 1}});let e=null,t=-1,l=-1;b.value.forEach(u=>{u[i.value]!==e?(e=u[i.value],t=0):t+=1,u.innerIndex=t,t>l&&(l=t)}),O.value=l+1,console.log(b.value),await ge(),await G(b.value)}async function Y(){await le(),await re()}async function le(){s.value.type==="band"?h.value=r.scaleBand().domain(g.value).range([0,n.value.ctrWidth]).paddingInner(.2).paddingOuter(.2).align(.5):s.value.type==="linear"?h.value=r.scaleLinear().domain(g.value).range([0,n.value.ctrWidth]).nice():h.value=r.scaleLog().domain(g.value).range([n.value.ctrWidth*.05,n.value.ctrWidth]).base(2).nice()}async function re(){A.value=z.value.append("g").attr("id","x-axis").attr("transform",`translate(0, ${n.value.ctrHeight})`).style("font-size",()=>p.isMobile?"8px":"14px"),E()}async function ie(e){e?(r.select("#x-axis").remove(),Y()):(h.value.domain(g.value),E())}function E(){const e=r.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=r.axisBottom(h.value);if(s.value.type==="band"&&t.tickSize(0),s.value.type==="linear"){const l=g.value[1]<10?g.value[1]:12;t.tickSize(-n.value.ctrHeight).ticks(l).tickPadding(10).tickSizeOuter(0).tickFormat(e)}s.value.type==="log"&&t.tickSize(-n.value.ctrHeight).ticks(5).tickPadding(10).tickSizeOuter(0).tickFormat(e),A.value.transition().call(t),s.value.type==="band"?A.value.call(l=>l.select(".domain").remove()):A.value.selectAll(".tick line").style("stroke","lightgrey").style("stroke-dasharray","4,2")}const O=x(0),S=m(()=>s.value.type==="band"?Math.ceil(Oe/g.value.length):1),K=m(()=>s.value.type==="band"?Math.ceil(O.value/S.value):O.value),ue=m(()=>s.value.type==="band"?h.value.bandwidth():null),I=m(()=>s.value.type==="band"?ue.value/S.value:n.value.ctrWidth/(g.value[1]-g.value[0])),T=m(()=>n.value.ctrHeight/K.value),v=m(()=>{const t=I.value/2*.9,l=T.value/2*.9;return s.value.type==="band"?K.value>S.value?Math.min(t,l):t:s.value.type==="linear"?Math.min(t,l):p.isMobile?3.3:5});function H(e){return s.value.type==="band"?oe(e):s.value.type==="linear"?ce(e):fe(e)}function V(e,t="update"){return t==="enter"?-v.value*2:t==="exit"?n.value.ctrHeight+v.value*2:s.value.type==="band"?se(e):s.value.type==="linear"?ve(e):de(e)}function oe(e){const t=i.value?e[i.value]:"",l=e.innerIndex%S.value;return h.value(t)+l*I.value+I.value/2}function se(e){const t=Math.floor(e.innerIndex/S.value);return i.value!=="occupation"?g.value[0]===""?t*T.value+T.value/2:t*T.value:t*v.value*2}function ce(e){return h.value(e[i.value])}function ve(e){return n.value.ctrHeight-v.value-e.innerIndex*v.value*2}function fe(e){return e[i.value]!==0?h.value(e[i.value]):10}function de(e){return n.value.ctrHeight-v.value-e.innerIndex*v.value*2}const q=m(()=>s.value.type==="log"?.65:.9);function me(e){return e in W||F(e)}const R=m(()=>{if(!c.value)return{};const e=L(c.value),t=F(e[0]);let l,u;if(t){const f=r.min(e),y=r.max(e);l=y-f>100?"log":"linear",u=y-f>100&&f===0?[1,y]:[f,y]}else l=me(c.value)?"custom":"ordinal",u=e.sort();return{type:l,domain:u}});async function ge(){const{type:e,domain:t}=R.value,l={ordinal:()=>r.scaleOrdinal().domain(t).range(Me),linear:()=>r.scaleLinear().domain(t).range([M.lowColor,M.highColor]),log:()=>r.scaleLog().domain(t).range([M.lowColor,M.highColor]),default:()=>null};N.value=(l[e]||l.default)()}function X(e){if(!c.value)return"#000000";if(R.value.type==="custom"){const t=e[c.value];return F(c.value)?W.vote[t]:W[c.value][t]}return R.value.type==="log"&&e[c.value]===0?M.logZeroColor:N.value(e[c.value])}const d=x(null);function U(e){const t=o.focusOptions.findIndex(l=>l.value===e.id);return j[t%j.length]}async function G(e){let t=z.value.select(".seats-group");t.empty()&&(t=z.value.append("g").attr("class","seats-group"));const l=r.transition().duration(2500),u=o.numberOfFetches===1?r.transition().duration(2500):l.transition().duration(2500),f=r.transition().duration(2500),y=t.selectAll("circle").data(e,a=>a.id);y.exit().transition(l).attr("cx",a=>H(a)).attr("cy",a=>V(a,"exit")).attr("r",v.value).attr("fill",a=>X(a)).attr("fill-opacity",0).remove(),y.enter().append("circle").attr("class","seat").attr("cx",a=>H(a)).attr("cy",a=>V(a,"enter")).attr("r",v.value).attr("fill",a=>X(a)).attr("fill-opacity",0).attr("stroke",a=>a.focus?U(a):null).attr("stroke-width",a=>a.focus?v.value*2:null).attr("stroke-opacity",a=>a.focus?Q:null).on("click",(a,k)=>{window.open(k.url,"_blank")}).on("mouseover",(a,k)=>pe(k)).on("mousemove",a=>he(a)).on("mouseout",()=>ye()).on("contextmenu",(a,k)=>xe(a,k)).transition(u).attr("cx",a=>H(a)).attr("cy",a=>V(a)).attr("fill",a=>X(a)).attr("fill-opacity",q.value).attr("cursor","pointer"),y.transition(f).attr("cx",a=>H(a)).attr("cy",a=>V(a)).attr("r",v.value).attr("fill",a=>X(a)).attr("fill-opacity",q.value).attr("stroke",a=>a.focus?U(a):null).attr("stroke-width",a=>a.focus?v.value*2:null).attr("stroke-opacity",a=>a.focus?Q:null).attr("cursor","pointer"),r.select(".seats-group").raise()}function pe(e){o.membersAsOfDate||d.value.select(".headshot img").attr("src",e.image),d.value.select(".name").text(e.name),i.value===c.value?d.value.select(".arrangement").text(e[i.value]):(d.value.select(".arrangement").text(e[i.value]),d.value.select(".feature").text(e[c.value])),d.value.style("visibility","visible")}function he(e){d.value.style("left",`${e.clientX+v.value}px`).style("top",`${e.clientY-v.value}px`)}function ye(){o.membersAsOfDate||d.value.select(".headshot img").attr("src",null),d.value.select(".name").text(null),d.value.select(".arrangement").text(null),d.value.select(".feature").text(null),d.value.select(".hint").text(null),d.value.style("visibility","hidden")}function xe(e,t){e.preventDefault(),o.memberFocus?$.value.includes(t.id)||o.setMemberFocus([...$.value,t.id]):o.setMemberFocus([t.id])}return(e,t)=>(Z(),J("div",Fe,[ke(o).membersAsOfDate?Ce("",!0):(Z(),J("div",De,t[0]||(t[0]=[C("img",null,null,-1)]))),t[1]||(t[1]=C("div",{class:"name"},null,-1)),t[2]||(t[2]=C("div",{class:"arrangement"},null,-1)),t[3]||(t[3]=C("div",{class:"feature"},null,-1)),t[4]||(t[4]=C("div",{class:"hint"},null,-1))]))}},_e=be(Ie,[["__scopeId","data-v-4e8f6d8c"]]);export{_e as default};
