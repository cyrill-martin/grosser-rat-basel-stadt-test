import{bc as U,i as P,j,n as z,r as v,c as f,o as X,f as J}from"./index-D0ja2nV0.js";import{d as r,b as D,c as y,o as H}from"./customColors-Dr-dxzXd.js";import{d as K}from"./debounce-B_grFKK4.js";const ae={__name:"TheLegend",setup(Q){const s=U(),u=P();j(()=>{w(),s.isMobile&&o.value.type&&b(o.value.type)}),z(()=>s.width,()=>{O()});const O=K(()=>{R()},200);async function R(){r.select("#svg-legend").remove(),await w(),await $()}async function w(){await G(),await x()}async function b(e){if(await L(),e==="band"){const t=l.value.length*13;await c.value.transition().attr("viewBox",`0 0 ${a.value.width} ${t}`).end()}else await c.value.transition().attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`).end()}async function x(){o.value.type!=="band"?(await q(),await T(),await W()):await B(l.value)}const c=v(null),g=v(null),a=v({width:null,height:null,margin:{top:null,right:5,bottom:25,left:5},ctrWidth:null,ctrHeight:null});async function L(){const e=r.select("#grand-council-basel-legend"),t=r.select("#grand-council-basel");a.value.width=await e.node().getBoundingClientRect().width,s.isMobile?o.value.type!=="band"?a.value.height=await t.node().getBoundingClientRect().height*.5:a.value.height=1:a.value.height=await t.node().getBoundingClientRect().height||250,a.value.margin.top=s.isMobile?5:20,a.value.ctrWidth=a.value.width-a.value.margin.left-a.value.margin.right,a.value.ctrHeight=a.value.height-a.value.margin.top-a.value.margin.bottom}const E=f(()=>u.asOfDate&&u.membersAsOfDate?u.membersAsOfDate:u.membersCurrent),d=f(()=>u.seatFeature);function F(e){return Array.from(new Set(E.value.map(t=>t[e])))}function S(e){return Number.isInteger(Number(e))}const l=f(()=>{if(!d.value)return[""];const e=F(d.value);if(S(e[0])){const t=r.min(e),n=r.max(e);return n-t>100&&t===0?[1,n]:[t,n]}return e.sort()}),o=f(()=>{const t=typeof l.value[0]=="string",n=l.value[1]<=100;return t?(u.setLegendIsIsLog(!1),{type:"band"}):!t&&n?(u.setLegendIsIsLog(!1),{type:"linear"}):(u.setLegendIsIsLog(!0),{type:"log"})});z(()=>o.value,(e,t)=>{const n=e.type!==t.type;$(n)},{deep:!1});const m=v(null),p=v(null);async function G(){const e=r.select("#grand-council-basel-legend");await L(),c.value=e.append("svg").attr("id","svg-legend").attr("viewBox",`0 0 ${a.value.width} ${a.value.height}`);const t=s.isMobile?a.value.ctrWidth*.5:a.value.margin.left;g.value=c.value.append("g").attr("id","legend-ctr").attr("transform",`translate(${t}, ${a.value.margin.top})`)}async function T(){o.value.type==="linear"?m.value=r.scaleLinear().domain(l.value).range([0,a.value.ctrHeight]):m.value=r.scaleLog().domain(l.value).range([0,a.value.ctrHeight]).base(2)}const k=f(()=>{const e=s.isMobile?.05:.1;return a.value.ctrWidth*e});async function W(){p.value=g.value.append("g").attr("id","legend-axis").attr("transform",`translate(${k.value}, 0)`),M()}async function C(e){return e==="linear"?[l.value[0],(l.value[0]+l.value[1])/2,l.value[1]]:[l.value[0],Math.floor(Math.sqrt(l.value[0]*l.value[1])),l.value[1]]}async function M(){const e=r.formatLocale({thousands:"'",grouping:[3]}).format(",.0f"),t=r.axisRight(m.value);if(o.value.type==="linear"){const n=await C("linear");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}if(o.value.type==="log"){const n=await C("log");t.tickSize(0).tickPadding(5).tickSizeOuter(0).tickValues(n).tickFormat(e)}p.value.transition().call(t).style("font-size",()=>s.isMobile?"8px":"14px"),p.value.call(n=>n.select(".domain").remove())}async function $(e){s.isMobile&&await b(o.value.type),e?(r.select("#legend-axis").remove(),r.select("#color-bar").remove(),r.select("#legend-group").remove(),x()):o.value.type!=="band"?(m.value.domain(l.value),M()):B(l.value)}async function q(){let e=c.value.select("#legendGradient");e.empty()&&(e=c.value.append("defs").append("linearGradient").attr("id","legendGradient").attr("x1","50%").attr("x2","50%").attr("y1","0%").attr("y2","100%"),e.append("stop").attr("offset","0%").attr("stop-color",D.lowColor),e.append("stop").attr("offset","100%").attr("stop-color",D.highColor));const t=r.transition().duration(1e3);g.value.append("rect").attr("id","color-bar").attr("x",0).attr("y",0).attr("width",k.value).transition(t).attr("height",a.value.ctrHeight).style("fill","url(#legendGradient)")}function N(e,t){return S(d.value)?y.vote[e]:d.value in y?y[d.value][e]:H[t%H.length]}async function B(e){let t=g.value.select("#legend-group");const n=s.isMobile?13:20,A=n/2*.75,I=e.map(i=>({id:`${d.value}_${i}`,value:i}));t.empty()&&(t=g.value.append("g").attr("id","legend-group"));const _=t.selectAll(".legend-item").data(I,i=>i.id);_.exit().transition().attr("transform",`translate(0, ${n*12})`).remove();const V=_.enter().append("g").attr("class","legend-item").attr("transform","translate(0, 0)");V.append("circle").attr("cx",A).attr("cy",0).attr("r",i=>i.value===""?null:A).attr("fill",(i,h)=>N(i.value,h)),V.append("text").attr("x",n).attr("y",0).style("font-size",()=>s.isMobile?"8px":"14px").attr("dominant-baseline","middle").text(i=>i.value),t.selectAll(".legend-item").data(I,i=>i.id).attr("transform",(i,h)=>`translate(0, ${n*h})`).select("text").text(i=>i.value)}return(e,t)=>(X(),J("div"))}};export{ae as default};
